# COTC Buff/Debuff Categories Reference
# This file documents how buffs and debuffs stack in COTC.
# Understanding this is critical for team composition.
#
# SOURCE: https://meowdb.com/db/octopath-traveler-cotc/the-ultimate-guide-to-buffs-and-debuffs/

schema_version: "1.0"

# =============================================================================
# CRITICAL TIMING RULE
# =============================================================================
# Some buffs and debuffs have DELAYED ACTIVATION!
# They only come into effect at the START of the NEXT unit's turn.
#
# This means:
# - Buffer must act BEFORE the DPS they're buffing
# - Debuffer must act BEFORE the DPS attacking the debuffed enemy
# - Speed tuning is essential for maximizing damage
#
# See turn_timing.yaml for detailed turn order planning.

# =============================================================================
# CORE STACKING RULES (VERIFIED from meowdb)
# =============================================================================
#
# 1. There are 6 "brackets" of buffs and 6 "brackets" of debuffs
# 2. Each bracket has a 30% cap
# 3. Same unit + same skill = extends duration only, NOT potency
# 4. Different abilities = stack in potency AND extend duration
# 5. Max buff/debuff duration is 9 turns
#
# WHAT BYPASSES THE 30% RULE:
# - Critical damage cap: separate bracket, 100% max
# - Break damage cap: separate bracket, 100% max  
# - Ultimate buffs/debuffs: separate bracket, can stack to 200%
# - Status ailment resistance: can go up to 100% (immune)
# - Enemy's buffs/debuffs on YOU: capped at 50%
#
# DEF BUFFS = straight damage mitigation
# - 30% PDEF buff = take 30% less physical damage (not scaled from stats)

# =============================================================================
# THE 6 BUFF BRACKETS
# =============================================================================

buff_brackets:
  - id: stats_up
    display_name: "Stats Up"
    description: "PATK, EATK, PDEF, EDEF, Speed, Crit Up"
    cap_percentage: 30
    includes:
      - phys_atk_up
      - elem_atk_up
      - phys_def_up
      - elem_def_up
      - speed_up
      - crit_up

  - id: weapon_damage_up
    display_name: "Weapon Damage Up"
    description: "Sword/Polearm/Dagger/Axe/Bow/Staff/Tome/Fan damage up"
    cap_percentage: 30
    notes: "Each weapon type is a separate sub-category but shares the bracket cap"

  - id: element_damage_up
    display_name: "Element Damage Up"
    description: "Fire/Ice/Lightning/Wind/Light/Dark damage up"
    cap_percentage: 30
    notes: "Each element is a separate sub-category but shares the bracket cap"

  - id: break_damage_up
    display_name: "Break Damage Up"
    description: "Damage dealt during enemy break state"
    cap_percentage: 100
    notes: "Stacks separately from weapon/element damage"

  - id: crit_damage_up
    display_name: "Critical Damage Up"
    description: "Bonus damage on critical hits"
    cap_percentage: 100
    notes: "Stacks separately from weapon/element damage"

  - id: ultimate_buffs
    display_name: "Ultimate Buffs"
    description: "Buffs from Ultimate skills"
    cap_percentage: 200
    notes: |
      Ultimate buffs belong to their OWN bracket.
      They stack MULTIPLICATIVELY with regular buffs.
      They also stack in duration with existing buffs.

# =============================================================================
# THE 6 DEBUFF BRACKETS
# =============================================================================

debuff_brackets:
  - id: stats_down
    display_name: "Stats Down"
    description: "Enemy PATK, EATK, PDEF, EDEF, Speed, Crit Down"
    cap_percentage: 30
    includes:
      - phys_atk_down
      - elem_atk_down
      - phys_def_down
      - elem_def_down
      - speed_down

  - id: weapon_res_down
    display_name: "Weapon Resistance Down"
    description: "Enemy Sword/Polearm/Dagger/etc resistance down"
    cap_percentage: 30
    notes: "Each weapon type is a separate sub-category"

  - id: element_res_down
    display_name: "Element Resistance Down"
    description: "Enemy Fire/Ice/Lightning/etc resistance down"
    cap_percentage: 30
    notes: "Each element is a separate sub-category"

  - id: break_damage_taken_up
    display_name: "Break Damage Taken Up"
    description: "Enemy takes more damage when broken"
    cap_percentage: 100

  - id: crit_damage_taken_up
    display_name: "Critical Damage Taken Up"
    description: "Enemy takes more damage from crits"
    cap_percentage: 100

  - id: ultimate_debuffs
    display_name: "Ultimate Debuffs"
    description: "Debuffs from Ultimate skills"
    cap_percentage: 200
    notes: "Stack multiplicatively with regular debuffs"

# =============================================================================
# DURATION MECHANICS (VERIFIED)
# =============================================================================

duration_mechanics:
  max_duration: 9  # turns
  
  stacking_rules:
    same_unit_same_skill: "Extends duration only, NOT potency"
    different_skills: "Stacks both potency AND duration"
    
  examples:
    - description: "Lynette 20% PATK/EATK buff used twice"
      result: "Still 20% buff, but lasts 4 turns"
    - description: "Lynette 20% PATK + Iris 15% PATK"
      result: "30% PATK for 4 turns, 20% EATK for 2 turns"

# =============================================================================
# MULTI-HIT DEBUFF STACKING (IMPORTANT!)
# =============================================================================
# Units like Sofia and Primrose with "hit 3-times to random enemies and 
# apply 15% resistance debuff for 2 turns" are powerful because:
# - If they hit a single enemy 3 times, debuff duration = 6 turns
# - Potency doesn't increase, but duration does

multi_hit_debuff_note: |
  Random multi-hit attacks that debuff are extremely powerful.
  Each hit extends the debuff duration.
  3 hits on same target = 3x the duration.

# =============================================================================
# STRATEGY NOTES
# =============================================================================

strategy_notes: |
  BUFF TIMING:
  - Apply buffs in early turns BEFORE breaking the enemy
  - Use max boost for longer duration on important buffs
  - Buffers should act BEFORE DPS units (speed tuning)
  
  DEBUFF TIMING:
  - Apply defense/resistance down before DPS acts
  - Stack multiple sources to reach 30% cap faster
  - Use multi-hit random attacks for long duration debuffs
  
  ULTIMATE SYNERGY:
  - Ultimate buffs stack MULTIPLICATIVELY with regular buffs
  - Example: Lynette's ultimate 20% + Primrose's skill 20% = more than 40%
  - Ultimate buffs also extend duration of matching regular buffs
