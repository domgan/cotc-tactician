# COTC Boss Schema
# All fields marked [HUMAN-REQUIRED] must be filled by someone with game knowledge.
# The LLM will NOT invent any values for these fields.
#
# Copy _template.yaml to create a new boss entry.

schema_version: "1.0"

fields:
  # ===========================================================================
  # IDENTITY
  # ===========================================================================
  id:
    type: string
    required: true
    source: "[HUMAN-REQUIRED]"
    description: "Unique identifier (lowercase, hyphenated)"
    pattern: "^[a-z0-9-]+$"
    example: "boss-name-variant"

  display_name:
    type: string
    required: true
    source: "[HUMAN-REQUIRED]"
    description: "Full display name as shown in game"

  display_name_jp:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Japanese display name"

  content_type:
    type: string
    required: true
    source: "[HUMAN-REQUIRED]"
    allowed_values: [story, story_boss, side_story, npc_battle, superboss, tower, arena, adversary_log, event, other]
    description: "What content this boss appears in (arena for base arena fights, adversary_log for EX/宿敵の写記 fights)"

  # ===========================================================================
  # EX FIGHT / ADVERSARY LOG FIELDS
  # ===========================================================================
  base_boss_id:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "For EX variants, references the base boss ID (e.g., 'arena-gertrude')"
    notes: "Used to link EX1/EX2/EX3 variants back to base boss"

  ex_rank:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    allowed_values: [base, ex1, ex2, ex3]
    description: "EX difficulty rank for Adversary Log bosses"
    notes: |
      - base: Standard arena/story version
      - ex1: First EX rematch (~2x HP, moderate difficulty)
      - ex2: Second EX rematch (~3x HP, high difficulty)
      - ex3: Third EX rematch (~5x HP, extreme difficulty)

  actions_per_turn:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    allowed_values: [1, 2, 3]
    description: "How many actions the boss takes per turn"
    notes: "EX bosses often gain extra actions (2→3) at HP thresholds"

  provoke_immunity:
    type: boolean
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "If true, boss cannot be provoked (common in arena/EX)"
    notes: "Most arena champions and EX bosses are provoke immune"

  successive_strike_resistance:
    type: boolean
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "If true, multi-hit attacks deal reduced damage per hit (120 NPCs onwards)"
    notes: |
      Starting from 120 NPCs (Divine Beast Lutiya EX3 onwards):
      - The more times you hit per attack, the LESS damage each hit does
      - Multi-hit attacks become inefficient for dealing damage
      - Single-hit nukes are optimal for DPS
      - Multi-hit still useful for shield shaving

  difficulty:
    type: string
    required: true
    source: "[HUMAN-REQUIRED]"
    allowed_values: [easy, normal, hard, very_hard, expert, extreme]
    description: "Relative difficulty rating"

  location:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Where this boss is found"

  level:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Boss level (100, 120, etc.)"

  # ===========================================================================
  # RANK VARIANTS (Adversary Log progression)
  # ===========================================================================
  rank_variants:
    type: object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Stats for each rank tier (Rank 1-3). EX variants go in SEPARATE files."
    notes: |
      For Adversary Log bosses, the base file contains Rank 1-3 data.
      EX variants (ex1, ex2, ex3) must be in their own files for RAG indexing.
      DO NOT put EX stats in comments - they won't be searchable!
    schema:
      rank1:
        type: object
        description: "Rank 1 stats (lowest difficulty)"
        schema:
          shield_count: {type: integer}
          hp: {type: integer}
          speed: {type: integer}
          level: {type: integer}
      rank2:
        type: object
        description: "Rank 2 stats (medium difficulty)"
        schema:
          shield_count: {type: integer}
          hp: {type: integer}
          speed: {type: integer}
          level: {type: integer}
      rank3:
        type: object
        description: "Rank 3 stats (high difficulty, before EX)"
        schema:
          shield_count: {type: integer}
          hp: {type: integer}
          speed: {type: integer}
          level: {type: integer}

  # ===========================================================================
  # STATS (for NPCs with known values)
  # ===========================================================================
  hp:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Boss HP pool"

  speed:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Boss speed stat"

  p_def:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Physical defense"

  e_def:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Elemental defense"

  status_immunity:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Status ailment immunity (none, 20%, 100%)"
    examples: ["none", "20%", "100%"]

  # ===========================================================================
  # WEAKNESSES & RESISTANCES
  # ===========================================================================
  weaknesses:
    type: object
    required: false  # Optional for multi-phase bosses
    source: "[HUMAN-REQUIRED]"
    description: "Elements and weapons the boss is weak to (optional for phase-based bosses)"
    schema:
      elements:
        type: array
        items: string
        allowed_values: [fire, ice, lightning, wind, light, dark]
      weapons:
        type: array
        items: string
        allowed_values: [sword, polearm, dagger, axe, bow, staff, tome, fan]

  resistances:
    type: object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Elements and weapons that deal reduced damage"
    schema:
      elements:
        type: array
        items: string
      weapons:
        type: array
        items: string

  immunities:
    type: object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Elements and weapons that deal no damage"
    schema:
      elements:
        type: array
        items: string
      weapons:
        type: array
        items: string

  # ===========================================================================
  # SHIELD MECHANICS
  # ===========================================================================
  shield_count:
    type: integer
    required: false  # Optional for multi-enemy encounters
    source: "[HUMAN-REQUIRED]"
    description: "Initial shield count (for single-enemy encounters)"

  # ===========================================================================
  # MULTI-ENEMY ENCOUNTERS
  # ===========================================================================
  enemies:
    type: array
    items: enemy_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "For multi-enemy encounters (up to 4 enemies in COTC)"
    
  enemy_object:
    name:
      type: string
      required: true
      description: "Enemy display name"
    name_jp:
      type: string
      required: false
      description: "Japanese name"
    is_main_target:
      type: boolean
      required: false
      default: false
      description: "Is this the primary target?"
    hp:
      type: integer
      required: false
      description: "Enemy HP"
    speed:
      type: integer
      required: false
      description: "Enemy speed stat"
    p_def:
      type: integer
      required: false
      description: "Physical defense"
    e_def:
      type: integer
      required: false
      description: "Elemental defense"
    shield_count:
      type: integer
      required: false
      description: "Shield count for this enemy"
    weaknesses:
      type: object
      required: false
      description: "Weaknesses for this enemy"
    notes:
      type: string
      required: false
      description: "Strategy notes for this enemy"

  # ===========================================================================
  # ACTIONS
  # ===========================================================================
  actions:
    type: array
    items: action_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Boss abilities/attacks"
    
  action_object:
    name:
      type: string
      required: true
      description: "Action name"
    name_jp:
      type: string
      required: false
      description: "Japanese name"
    effect:
      type: string
      required: true
      description: "What this action does"
    trigger:
      type: string
      required: false
      description: "When/how this action is used"
    threat_level:
      type: string
      required: false
      allowed_values: [low, medium, high, extreme]
      description: "How dangerous this action is"

  # ===========================================================================
  # ENRAGE TIMER
  # ===========================================================================
  enrage_turn:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Turn when boss enrages (instant death mechanics)"
    
  enrage_description:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "What happens when boss enrages"

  shield_phases:
    type: array
    items: shield_phase_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "If shield count changes per phase"

  shield_phase_object:
    phase:
      type: integer
      required: true
      description: "Phase number (1-indexed)"
    shield_count:
      type: integer
      required: true
      description: "Shield count in this phase"
    trigger:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "What triggers this phase (HP threshold, turn count, etc.)"

  # ===========================================================================
  # AURAS / STANCES (EX FIGHT MECHANICS)
  # ===========================================================================
  auras:
    type: array
    items: aura_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Special aura/stance mechanics (common in EX fights)"
    notes: |
      Auras are visual indicators (purple/blue flames) that signal:
      - Weakness changes (locking/unlocking vulnerabilities)
      - Counter attacks when hitting wrong weakness
      - Special damage modifiers
      
  aura_object:
    name:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "Name of the aura/stance"
      example: "Counter Stance"
    
    trigger:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "When this aura activates"
      examples: ["Battle start", "Break recovery", "HP < 50%"]
    
    active_indicator:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "Visual indicator when aura is active"
      examples: ["Purple flame", "Blue aura"]
    
    weakness_changes:
      type: object
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "How weaknesses change during this aura"
      schema:
        locked:
          type: array
          items: string
          description: "Weaknesses that become locked (cannot be hit)"
        unlocked:
          type: array
          items: string
          description: "Weaknesses that remain open"
    
    counter_trigger:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "What triggers the counter attack"
      example: "Hitting locked weakness"
    
    counter_effect:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "What happens when counter is triggered"
      examples: ["+1 action next turn", "Wipe attack"]
    
    removal_condition:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "How to remove this aura"
      examples: ["Break", "Turn end", "HP threshold"]

  # ===========================================================================
  # HP THRESHOLDS (STRUCTURED PHASE TRIGGERS)
  # ===========================================================================
  hp_thresholds:
    type: array
    items: hp_threshold_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Structured HP-based phase triggers"
    notes: "More structured than generic 'phases' for precise planning"
    
  hp_threshold_object:
    hp_percent:
      type: integer
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "HP percentage that triggers this event"
      example: 75
    
    event:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "What happens at this HP threshold"
      example: "Phase 2 activation"
    
    behavior_changes:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "Detailed behavior changes"
      example: "Shield +3, double actions, new attack pattern"
    
    actions_per_turn:
      type: integer
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "Actions per turn after this threshold"
    
    new_weaknesses:
      type: array
      items: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "Weaknesses that open at this threshold"
    
    locked_weaknesses:
      type: array
      items: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "Weaknesses that become locked at this threshold"

  # ===========================================================================
  # MECHANICS
  # ===========================================================================
  mechanics:
    type: array
    items: mechanic_object
    required: true
    source: "[HUMAN-REQUIRED]"
    description: "Boss abilities and patterns"
    llm_usage: "Critical for determining team requirements"

  mechanic_object:
    name:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "Name of the mechanic/attack"

    mechanic_type:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      allowed_values: 
        - attack
        - buff_self
        - debuff_party
        - ultimate
        - passive
        - phase_transition
        - enrage
        - counter
        - other
      description: "Category of mechanic"

    trigger:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "When this mechanic occurs (turn count, HP threshold, etc.)"
      example: "Turn 7, then every 5 turns"

    target:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      allowed_values: 
        - single
        - front_row
        - back_row
        - all
        - random
        - highest_hp
        - lowest_hp
        - provoker
      description: "Who the mechanic targets"

    damage_type:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      allowed_values: [physical, elemental, true, none]
      description: "Type of damage dealt (if any)"

    element:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      allowed_values: [fire, ice, lightning, wind, light, dark]
      description: "Element of attack (if elemental)"

    effects:
      type: array
      items: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "Status effects applied"
      example: ["poison", "blind", "atk_down"]

    threat_level:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      allowed_values: [low, medium, high, critical]
      description: "How dangerous this mechanic is"

    counter_strategy:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "How to handle this mechanic"
      llm_usage: "Directly informs team requirements"

  # ===========================================================================
  # PHASES
  # ===========================================================================
  phases:
    type: array
    items: phase_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Distinct battle phases with different behaviors"

  phase_object:
    phase_number:
      type: integer
      required: true
      description: "Phase number (1-indexed)"

    trigger:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "HP threshold or turn count that triggers this phase"
      examples: ["HP < 50%", "Turn 10"]

    behavior_changes:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "What changes in this phase"

    priority_actions:
      type: string
      required: false
      source: "[HUMAN-REQUIRED]"
      description: "What the player should prioritize in this phase"

  # ===========================================================================
  # TEAM REQUIREMENTS
  # ===========================================================================
  required_roles:
    type: array
    items: role_requirement_object
    required: true
    source: "[HUMAN-REQUIRED]"
    llm_usage: "Primary guide for team composition"

  role_requirement_object:
    role:
      type: string
      required: true
      allowed_values: [tank, healer, buffer, debuffer, breaker, dps]
      description: "Required role"

    priority:
      type: string
      required: true
      allowed_values: [required, strongly_recommended, recommended, optional]
      description: "How important this role is"

    reason:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "Why this role is needed for this boss"

  required_capabilities:
    type: array
    items: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Specific capabilities needed beyond roles"
    llm_usage: "Detailed matching beyond role"
    example:
      - "Party-wide healing"
      - "Provoke skill"
      - "High hit count for breaking"
      - "Fire damage for weakness"

  # ===========================================================================
  # TIMING
  # ===========================================================================
  turn_limit:
    type: integer
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Turn limit before enrage or wipe mechanic"

  critical_turns:
    type: array
    items: critical_turn_object
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Specific turns where actions are critical"

  critical_turn_object:
    turn:
      type: integer
      required: true
      description: "Turn number"
    event:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "What happens on this turn"
    required_action:
      type: string
      required: true
      source: "[HUMAN-REQUIRED]"
      description: "What the player must do"

  # ===========================================================================
  # STRATEGY NOTES
  # ===========================================================================
  general_strategy:
    type: string
    required: true
    source: "[HUMAN-REQUIRED]"
    description: "Overall approach to the fight"
    llm_usage: "High-level guidance for reasoning"

  common_mistakes:
    type: array
    items: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Things players commonly get wrong"

  # ===========================================================================
  # METADATA
  # ===========================================================================
  data_confidence:
    type: string
    required: true
    source: "[HUMAN-REQUIRED]"
    allowed_values: [verified, tested, theoretical, incomplete]
    description: "How reliable is this data?"

  data_source:
    type: string
    required: false
    source: "[HUMAN-REQUIRED]"
    description: "Where this data came from (wiki, testing, JP info)"

  last_updated:
    type: date
    required: true
    source: "[HUMAN-REQUIRED]"
    format: "YYYY-MM-DD"
